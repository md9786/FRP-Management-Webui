<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FRP Status</title>
  <script src="https://cdn.tailwindcss.com"></script>
<style>
  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: linear-gradient(180deg, #0f172a 0%, #0b0f1a 50%, #1e1b2e 100%);
    color: #f1f5f9;
  }

  .card {
    background: linear-gradient(90deg, #1e293b 0%, #111827 100%);
    border-radius: 0.375rem;
    color: #e5e7eb;
  }

  .btn-secondary {
    background: linear-gradient(90deg, #4b4b4b 0%, #3a3a3a 100%);
    transition: background 0.2s ease, transform 0.2s ease;
    color: #f1f5f9;
    border-radius: 0.375rem;
  }

  .btn-secondary:hover {
    background: linear-gradient(90deg, #5b5b5b 0%, #4a4a4a 100%);
    transform: translateY(-2px);
  }

  .btn-secondary:active {
    background: linear-gradient(90deg, #6b6b6b 0%, #5a5a5a 100%);
  }

  .log-pre {
    background-color: #2d2d4b;
    border: 1px solid #334155;
    color: #e5e7eb;
    white-space: pre-wrap;
    word-break: break-word;
  }

  .content-wrapper { position: relative; z-index: 2; }
  .floating-icons { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; z-index: 1; }
  .floating-icon { position: absolute; opacity: 0.05; font-size: 6rem; animation: float 6s ease-in-out infinite; color: #6366f1; }
  .floating-icon:nth-child(1) { top: 40%; left: 80%; animation-delay: 0s; }
  .floating-icon:nth-child(2) { top: 60%; left: 67%; animation-delay: 1s; }
  .floating-icon:nth-child(3) { top: 40%; left: 54%; animation-delay: 2s; }
  .floating-icon:nth-child(4) { top: 60%; left: 41%; animation-delay: 3s; }
  .floating-icon:nth-child(5) { top: 40%; left: 28%; animation-delay: 4s; }
  .floating-icon:nth-child(6) { top: 80%; left: 54%; animation-delay: 5s; }
  @keyframes float { 0%, 100% { transform: translateY(0px) rotate(0deg); } 50% { transform: translateY(-20px) rotate(5deg); } }
</style>

</head>
<body class="text-gray-100 min-h-screen">
  <div class="floating-icons" id="floating-icons-container"></div>
  <div class="content-wrapper">
    <div class="flex">
      <!-- Sidebar -->
      {{template "sidebar.html" .}}
      <div class="flex-1 p-8">
      <!-- Main Content -->
      <div class="flex-1 p-8">
        <div class="max-w-4xl mx-auto">
          <h1 class="text-2xl font-semibold text-gray-100 mb-4">FRP Status</h1>
          <div class="card rounded-xl p-6 mb-4 shadow-lg">
            <h5 class="text-lg font-semibold text-gray-100 mb-3">Version</h5>
            <pre id="version" class="log-pre p-4 mb-4 rounded-lg text-sm">{{ .Version }}</pre>
            <h5 class="text-lg font-semibold text-gray-100 mb-3">Running Services</h5>
            <pre id="running" class="log-pre p-4 mb-4 rounded-lg text-sm">{{ .Running }}</pre>
            <h5 class="text-lg font-semibold text-gray-100 mb-3">Enabled Services</h5>
            <pre id="enabled" class="log-pre p-4 mb-4 rounded-lg text-sm">{{ .Enabled }}</pre>
            <h5 class="text-lg font-semibold text-gray-100 mb-3">Server Configs</h5>
            <pre id="server-configs" class="log-pre p-4 mb-4 rounded-lg text-sm">{{ .ServerConfigs }}</pre>
            <h5 class="text-lg font-semibold text-gray-100 mb-3">Client Configs</h5>
            <pre id="client-configs" class="log-pre p-4 mb-4 rounded-lg text-sm">{{ .ClientConfigs }}</pre>
            <a href="/" class="btn-secondary px-4 py-2 rounded-lg text-gray-200 text-center inline-block">Back</a>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    function processLogs(elementId) {
      const element = document.getElementById(elementId);
      let logs = element.innerText;
      // Split logs into lines
      const lines = logs.split('\n');
      // Process each line
      const processedLines = lines.map(line => {
        // Check if the line is an frpc log (contains [I] or similar)
        if (line.includes('frpc[') && line.includes(' [I] ')) {
          // Extract the initial systemd timestamp (e.g., "Aug 19 03:00:17")
          const systemdTimestampMatch = line.match(/^[A-Za-z]{3}\s+\d{1,2}\s+\d{2}:\d{2}:\d{2}\s+/);
          const systemdTimestamp = systemdTimestampMatch ? systemdTimestampMatch[0] : '';
          // Remove the duplicate timestamp and metadata (e.g., "2025-08-19 03:00:17.803 [I] [sub/root.go:149]")
          const cleanedLine = line.replace(/\d{4}-\d{2}-\d{2}\s+\d{2}:\d{2}:\d{2}\.\d+\s+\[I\]\s+\[[^\]]+\]\s*/, '');
          // Return the line with the systemd timestamp prepended
          return systemdTimestamp + cleanedLine;
        }
        // Return systemd lines unchanged
        return line;
      });
      // Remove hostname if present
      const finalLogs = processedLines.join('\n').replace(/dashingorder\.aeza\.network/g, '');
      element.innerText = finalLogs || "No data available";
    }
    // Process all pre elements on page load
    window.onload = () => {
      ['version', 'running', 'enabled', 'server-configs', 'client-configs'].forEach(id => {
        processLogs(id);
      });
    };
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const container = document.getElementById('floating-icons-container');
      if (container) {
        const techEmojis = ['💻', '🖥️', '💾', '💿', '🔌', '📡', '🛰️', '🚀', '⚙️', '🔧', '🔬', '💡', '📈', '📊', '🔗', '🌐', '☁️', '⚡️', '🤖', '👾', '📱', '⌨️', '🖱️', '🔋', '🧠'];
        const iconCount = 6; // As per the CSS
        let iconsHtml = '';
        for (let i = 0; i < iconCount; i++) {
          const randomEmoji = techEmojis[Math.floor(Math.random() * techEmojis.length)];
          iconsHtml += `<div class="floating-icon">${randomEmoji}</div>`;
        }
        container.innerHTML = iconsHtml;
      }
    });
  </script>
</body>
</html>